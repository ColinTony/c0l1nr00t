---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import { useTranslations } from "../../i18n/utils";

const lang = "en";
const t = useTranslations(lang);

const posts = await getCollection("blog", ({ id, data }) => {
    return id.startsWith("en/") && !data.draft;
});

const sortedPosts = posts
    .sort((a, b) => {
        if (a.data.pinned && !b.data.pinned) return -1;
        if (!a.data.pinned && b.data.pinned) return 1;
        return b.data.date.valueOf() - a.data.date.valueOf();
    })
    .slice(0, 3);

const writeups = await getCollection("writeups", ({ id, data }) => {
    return id.startsWith("en/") && data.status === "published";
});
const sortedWriteups = writeups
    .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
    .slice(0, 3);
---

<BaseLayout title="c0l1nr00t | Lab" description={t("hero.lead")}>
    <section class="hero container">
        <p class="kicker mono">{t("hero.kicker")}</p>
        <h1>{t("hero.headline")}</h1>
        <p class="lead">{t("hero.lead")}</p>
        <div class="ctas">
            <a href={`/${lang}/writeups`} class="btn btn-primary mono"
                >{t("cta.writeups")}</a
            >
            <a href={`/${lang}/about`} class="btn btn-outline mono"
                >{t("cta.about")}</a
            >
        </div>
    </section>

    <section class="container section">
        <h2 class="mono">{t("section.latest_posts")}</h2>
        <div class="grid">
            {
                sortedPosts.map((post) => (
                    <article class="card">
                        <a href={`/${lang}/blog/${post.slug.split("/")[1]}`}>
                            <h3>{post.data.title}</h3>
                            <p class="date mono">
                                {post.data.date.toISOString().split("T")[0]}
                            </p>
                            <p>{post.data.description}</p>
                        </a>
                    </article>
                ))
            }
        </div>
    </section>

    <section class="container section">
        <h2 class="mono">{t("section.latest_writeups")}</h2>
        <div class="grid">
            {
                sortedWriteups.map((post) => (
                    <article class="card">
                        <a
                            href={`/${lang}/writeups/${post.slug.split("/")[1]}`}
                        >
                            <h3>{post.data.title}</h3>
                            <div class="meta mono">
                                <span
                                    class={`difficulty ${post.data.difficulty}`}
                                >
                                    {post.data.difficulty}
                                </span>
                                <span>{post.data.platform}</span>
                            </div>
                        </a>
                    </article>
                ))
            }
        </div>
    </section>
</BaseLayout>

<style>
    .hero {
        padding: 4rem 1rem;
        border-bottom: 1px solid var(--border);
    }
    .kicker {
        color: var(--accent);
        margin-bottom: 0.5rem;
    }
    .lead {
        font-size: 1.2rem;
        color: var(--muted);
        max-width: 600px;
    }
    .ctas {
        margin-top: 2rem;
        display: flex;
        gap: 1rem;
    }
    .btn {
        display: inline-block;
        padding: 0.6rem 1.2rem;
        border-radius: var(--radius);
        text-decoration: none;
        font-weight: bold;
        transition: all 0.2s;
    }
    .btn-primary {
        background: var(--accent);
        color: #fff;
        border: 1px solid var(--accent);
    }
    .btn-primary:hover {
        background: #26853b;
    }
    .btn-outline {
        border: 1px solid var(--border);
        color: var(--text);
    }
    .btn-outline:hover {
        border-color: var(--accent2);
        color: var(--accent2);
    }
    .section {
        padding: 3rem 1rem;
    }
    .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
        margin-top: 1.5rem;
    }
    .card {
        background: var(--bg1);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 1.5rem;
        transition:
            transform 0.2s,
            box-shadow 0.2s;
    }
    .card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow);
        border-color: var(--accent2);
    }
    .card a {
        color: inherit;
        text-decoration: none;
    }
    .card h3 {
        margin-top: 0;
        color: var(--accent2);
    }
    .date {
        font-size: 0.85rem;
        color: var(--muted);
    }
    .meta {
        display: flex;
        gap: 1rem;
        font-size: 0.85rem;
        margin-top: 1rem;
    }
    .difficulty {
        text-transform: uppercase;
        font-weight: bold;
    }
    .difficulty.easy {
        color: var(--accent);
    }
    .difficulty.medium {
        color: var(--warn);
    }
    .difficulty.hard {
        color: var(--danger);
    }
    .difficulty.insane {
        color: #a371f7;
    }
</style>
